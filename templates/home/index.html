{% extends "layout/layout.html" %}

{% block script %}
    <script src="/static/js/vendors/zoom.js"></script>
{% endblock %}

{% block content %}

    <header id="rtsHeader">
        <div class="header-topbar header-topbar1">
            <div class="container">
                <div class="header-top-area">
                    <div class="slider-div">
                        <div class="swiper rts-topSlide1">
                            <div class="swiper-wrapper">
                                <div class="swiper-slide">
                                    <h3 class="welcome-text">Convierte tu idea en algo único
                                        <a href="#">Diseña ahora</a>
                                    </h3>
                                </div>
                                <div class="swiper-slide">
                                    <h3 class="welcome-text">Personalizados hechos para ti
                                        <a href="#">Ver opciones</a>
                                    </h3>
                                </div>
                                <div class="swiper-slide">
                                    <h3 class="welcome-text">Regalos que sí se recuerdan
                                        <a href="#">Descubrir</a>
                                    </h3>
                                </div>
                                <div class="swiper-slide">
                                    <h3 class="welcome-text">Tú imaginas, nosotros lo creamos<a href="#">
                                        Cuéntanos tu idea</a></h3>
                                </div>
                            </div>
                            <div class="slider-navigation2">
                                <div class="swiper-button-prev slider-btn prev"><i class="rt rt-arrow-left-long"></i>
                                </div>
                                <div class="swiper-button-next slider-btn next"><i class="rt rt-arrow-right-long"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="navbar-sticky">
            <div class="container">
                <div class="navbar-part navbar-part1">
                    <div class="navbar-inner">
                        <div class="left-side">
                            <div class="hamburger-1">
                                <a href="#" class="nav-menu-link">
                                    <span class="dot1"></span>
                                    <span class="dot2"></span>
                                    <span class="dot3"></span>
                                    <span class="dot4"></span>
                                    <span class="dot5"></span>
                                    <span class="dot6"></span>
                                    <span class="dot7"></span>
                                    <span class="dot8"></span>
                                    <span class="dot9"></span>
                                </a>
                            </div>

                            <a href="{% url 'home' %}" class="logo"><img src="/static/images/logo1.svg"
                                                                         alt="weiboo-logo"></a>
                        </div>
                        <div class="rts-menu">
                            <nav class="menus menu-toggle">
                                <ul class="nav__menu">

                                    <li class="has-dropdown"><a class="menu-item active1"
                                                                href="{% url 'home' %}">Inicio </a></li>

                                    <li class="has-dropdown"><a class="menu-item" href="#">Productos <i
                                            class="rt-plus"></i></a>
                                        <ul class="dropdown-ul">
                                            {% for categoria in categorias %}
                                                <li class="dropdown-li">
                                                    <a class="dropdown-link"
                                                       href="{% url 'productos:productos_por_categoria' categoria.id_categoria %}">
                                                        {{ categoria.nombre }}
                                                    </a>
                                                </li>
                                            {% empty %}
                                                <li class="dropdown-li">
                                                    <span class="dropdown-link">No hay categorías disponibles</span>
                                                </li>
                                            {% endfor %}
                                            <li class="dropdown-li"><a class="dropdown-link"
                                                                       href="{% url 'productos:producto_list' %}">Todos
                                                los productos</a>
                                            </li>
                                        </ul>
                                    </li>

                                    <li class="has-dropdown"><a class="menu-item" href="#">Diseña tu idea <i
                                            class="rt-plus"></i></a>
                                        <ul class="dropdown-ul">
                                            <li class="dropdown-li"><a class="dropdown-link" href="">Cuéntanos tu
                                                idea</a>
                                            </li>
                                            <li class="dropdown-li"><a class="dropdown-link" href="">Personalizados</a>
                                            </li>
                                            <li class="dropdown-li"><a class="dropdown-link" href="">Casos
                                                realizados</a>
                                            </li>
                                        </ul>
                                    </li>

                                    <li class="has-dropdown"><a class="menu-item" href="#">Ayuda <i class="rt-plus"></i></a>
                                        <ul class="dropdown-ul">
                                            <li class="dropdown-li"><a class="dropdown-link" href="{% url 'faq' %}">Preguntas
                                                frecuentes</a></li>
                                            <li class="dropdown-li"><a class="dropdown-link" href="{% url 'about' %}">Acerca
                                                de</a></li>
                                        </ul>
                                    </li>
                                    <li><a class="menu-item" href="{% url 'contact' %}">Contacto</a></li>
                                </ul>
                            </nav>
                        </div>
                        <div class="responsive-hamburger">
                            <div class="hamburger-1">
                                <a href="#" class="nav-menu-link">
                                    <span class="dot1"></span>
                                    <span class="dot2"></span>
                                    <span class="dot3"></span>
                                    <span class="dot4"></span>
                                    <span class="dot5"></span>
                                    <span class="dot6"></span>
                                    <span class="dot7"></span>
                                    <span class="dot8"></span>
                                    <span class="dot9"></span>
                                </a>
                            </div>
                        </div>
                        <div class="header-action-items header-action-items1">
                            <div class="search-part">
                                <div class="search-icon action-item icon"><i class="rt-search"></i></div>
                                <div class="search-input-area">
                                    <div class="container">
                                        <div class="search-input-inner">
                                            <div class="input-div">
                                                <input id="searchInput1" class="search-input" type="text"
                                                       placeholder="Search by keyword or #">
                                            </div>
                                            <div class="search-close-icon"><i class="rt-xmark"></i></div>
                                        </div>
                                    </div>
                                </div>
                            </div>


                            <a href="{% url 'account' %}" class="account">
                                {% if user.is_authenticated %}
                                    <span class="user-initial"> {{ user.first_name|slice:":1"|upper }}{{ user.last_name|slice:":1"|upper }}</span>
                                {% else %}
                                    <i class="rt-user-2"></i>
                                {% endif %}
                            </a>


                            <div class="cart action-item">
                                <div class="cart-nav">
                                    <div class="cart-icon icon">
                                        <a href="#0">
                                            <i aria-hidden="true" class="fas fa-shopping-basket"></i>
                                        </a>
                                        <span id="header-cart-badge" class="wishlist-dot icon-dot">0</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Header cart -->
        <div class="cart-bar">
            <div class="cart-header">
                <h3 class="cart-heading">MI CARRITO (<span id="cart-count">0</span> ITEMS)</h3>
                <div class="close-cart"><i class="fal fa-times"></i></div>
            </div>

            <div class="product-area" id="header-product-area">
                <!-- JS rellenará con items -->
                <div class="empty-cart-message">Cargando...</div>
            </div>

            <div class="cart-bottom-area">
                <span class="spend-shipping"><i class="fal fa-truck"></i> HACEMOS ENVÍOS <span
                        class="amount">LOCALES</span></span>
                <span class="total-price">TOTAL: <span class="price" id="header-total">$0.00</span></span>
                <a href="{% url 'productos:cart' %}" class="view-btn cart-btn">VER CARRITO</a>
            </div>
        </div>

        <!-- slide-bar start -->
        <aside class="slide-bar">
            <div class="offset-sidebar">
                <a class="hamburger-1 mobile-hamburger-1 ml--30" href="#"><span><i class="rt-xmark"></i></span></a>
            </div>
            <!-- offset-sidebar start -->
            <div class="offset-sidebar-main">
                <div class="offset-widget mb-40">
                    <div class="info-widget">
                        <img src="/static/images/logo1.svg" alt="">
                        <p class="mb-30">
                            We must explain to you how all seds this mistakens idea denouncing pleasures and praising
                            account.
                        </p>
                    </div>
                    <div class="info-widget info-widget2">
                        <h4 class="offset-title mb-20">Get In Touch </h4>
                        <ul>
                            <li class="info phone"><a href="tel:78090790890208806803">780 907 908 90, 208 806 803</a>
                            </li>
                            <li class="info email"><a href="email:pixcelsthemes@gmail.com">pixcelsthemes@gmail.com</a>
                            </li>
                            <li class="info web"><a href="www.webexample.com">www.webexample.com</a></li>
                            <li class="info location">13/A, New Pro State, NYC</li>
                        </ul>
                        <div class="offset-social-link">
                            <h4 class="offset-title mb-20">Follow Us </h4>
                            <ul class="social-icon">
                                <li><a href="#"><i class="fab fa-facebook-f"></i></a></li>
                                <li><a href="#"><i class="fab fa-twitter"></i></a></li>
                                <li><a href="#"><i class="fab fa-youtube"></i></a></li>
                                <li><a href="#"><i class="fab fa-linkedin"></i></a></li>
                                <li><a href="#"><i class="fab fa-behance"></i></a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <!-- offset-sidebar end -->
            <!-- side-mobile-menu start -->
            <nav class="side-mobile-menu side-mobile-menu1">
                <ul id="mobile-menu-active">

                    <li><a class="mm-link" href="{% url 'home' %}">Inicio</a></li>

                    <li class="has-dropdown firstlvl">
                        <a class="mm-link" href="">Productos <i class="rt-angle-down"></i></a>

                        <ul class="sub-menu mega-dropdown-mobile">
                            <li class="mega-dropdown-li">
                                <ul class="mega-dropdown-ul mm-show">

                                    {% for categoria in categorias %}
                                        <li class="dropdown-li"><a class="dropdown-link"
                                                                   href="{% url 'productos:productos_por_categoria' categoria.id_categoria %}">{{ categoria.nombre }}</a>
                                        </li>
                                    {% empty %}
                                        <li class="dropdown-li"><span
                                                class="dropdown-link">No hay categorías disponibles</span>
                                        </li>
                                    {% endfor %}
                                    <li class="dropdown-li"><a class="dropdown-link"
                                                               href="{% url 'productos:producto_list' %}">Todos
                                        los productos</a>
                                    </li>
                                </ul>
                            </li>
                        </ul>

                    </li>
                    <li class="has-dropdown firstlvl">
                        <a class="mm-link" href="">Diseña tu idea <i class="rt-angle-down"></i></a>
                        <ul class="sub-menu">
                            <li><a href="">Cuéntanos tu idea</a></li>
                            <li><a href="">Personalizados</a></li>
                            <li><a href="">Casos realizados</a></li>
                        </ul>
                    </li>
                    <li class="has-dropdown firstlvl">
                        <a class="mm-link" href="">Ayuda <i class="rt-angle-down"></i></a>
                        <ul class="sub-menu">
                            <li><a href="{% url 'faq' %}">Preguntas frecuentes</a></li>
                            <li><a href="{% url 'about' %}">Acerca de</a></li>

                        </ul>
                    </li>
                    <li><a class="mm-link" href="{% url 'contact' %}">Contacto</a></li>
                </ul>
            </nav>


            <div class="header-action-items header-action-items1 header-action-items-side">
                <div class="search-part">
                    <div class="search-icon action-item icon"><i class="rt-search"></i></div>
                    <div class="search-input-area">
                        <div class="container">
                            <div class="search-input-inner">
                                <select id="custom-select">
                                    <option value="hide">All Catagory</option>
                                    <option value="all">All</option>
                                    <option value="men">Men</option>
                                    <option value="women">Women</option>
                                    <option value="shoes">Shoes</option>
                                    <option value="shoes">Glasses</option>
                                    <option value="shoes">Bags</option>
                                    <option value="shoes">Assesories</option>
                                </select>
                                <div class="input-div">
                                    <div class="search-input-icon"><i class="rt-search mr--10"></i></div>
                                    <input class="search-input" type="text" placeholder="Search by keyword or #">
                                </div>
                                <div class="search-close-icon"><i class="rt-xmark"></i></div>
                            </div>
                        </div>
                    </div>
                </div>


                <div class="cart action-item">
                    <div class="cart-nav">
                        <div class="cart-icon icon"><i class="rt-cart"></i><span id="header-cart-badge-movil"
                                                                                 class="wishlist-dot icon-dot">0</span>
                        </div>
                    </div>
                </div>

                <a href="{% url 'account' %}" class="account"><i class="rt-user-2"></i></a>
            </div>

            <!-- side-mobile-menu end -->
        </aside>


        <!--================= Banner Section Start Here =================-->
        <div class="banner banner-1 bg-image">
            <div class="container">
                <div class="banner-inner">
                    <div class="row">
                        <div class="col-xl-2 col-md-4 col-sm-12 gutter-1">
                            <div class="catagory-sidebar">
                                <div class="widget-bg">
                                    <h2 class="widget-title">
                                        Categorías <i class="rt-angle-down"></i>
                                    </h2>
                                    <nav>
                                        <ul>
                                            {% for categoria in categorias %}
                                                <li>
                                                    <a href="{% url 'productos:productos_por_categoria' categoria.id_categoria %}">
                                                        {{ categoria.nombre }}
                                                        <i class="rt rt-arrow-right-long"></i>
                                                    </a>
                                                </li>
                                            {% empty %}
                                                <li>No hay categorías disponibles</li>
                                            {% endfor %}
                                        </ul>
                                    </nav>
                                </div>

                            </div>
                        </div>
                        <div class="col-xl-10 col-md-8 col-sm-12 gutter-2">
                            <div class="swiper bannerSlide2">
                                <div class="swiper-wrapper">

                                    <div class="swiper-slide">
                                        <div class="banner-single bg-image bg-image-3-SV">
                                            <div class="container">
                                                <div class="single-inner">
                                                    <div class="content-box">
                                                        <p class="slider-subtitle"><img
                                                                src="/static/images/banner/wvbo-icon.png" alt="">
                                                            Regalos personalizados para enamorar </p>
                                                        <h2 class="slider-title"> SAN VALENTÍN </h2>
                                                        <div class="slider-description">
                                                            <p>Detalles únicos en playeras, madera y más, hechos con
                                                                amor</p>
                                                        </div>
                                                        <a href="#" class="slider-btn2">Conocer más</a>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="swiper-slide">
                                        <div class="banner-single bg-image bg-image-3-1">
                                            <div class="container">
                                                <div class="single-inner">
                                                    <div class="content-box">
                                                        <p class="slider-subtitle"><img
                                                                src="/static/images/banner/wvbo-icon.png" alt=""> Da
                                                            forma a tus ideas en 3D </p>
                                                        <h2 class="slider-title"> IMPRESIÓN 3D </h2>
                                                        <div class="slider-description">
                                                            <p>Prototipos y piezas personalizadas con alta precisión</p>
                                                        </div>
                                                        <a href="#" class="slider-btn2">Conocer más</a>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>


                                    <div class="swiper-slide">
                                        <div class="banner-single bg-image bg-image-3-3">
                                            <div class="container">
                                                <div class="single-inner">
                                                    <div class="content-box">
                                                        <p class="slider-subtitle"><img
                                                                src="/static/images/banner/wvbo-icon.png" alt="">
                                                            Detalles perfectos en madera y más </p>
                                                        <h2 class="slider-title"> CORTE Y GRABADO <br> LÁSER</h2>
                                                        <div class="slider-description">
                                                            <p>Personalización profesional en madera, acrílico y más</p>
                                                        </div>
                                                        <a href="#" class="slider-btn2">Conocer más</a>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="swiper-slide">
                                        <div class="banner-single bg-image bg-image-3-4">
                                            <div class="container">
                                                <div class="single-inner">
                                                    <div class="content-box">
                                                        <p class="slider-subtitle"><img
                                                                src="/static/images/banner/wvbo-icon.png" alt="">
                                                            Playeras personalizadas que destacan </p>
                                                        <h2 class="slider-title"> ESTAMPADO DE <br> PLAYERAS</h2>
                                                        <div class="slider-description">
                                                            <p>Diseños únicos con impresión duradera y de calidad</p>
                                                        </div>
                                                        <a href="#" class="slider-btn2">Conocer más</a>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>


                                </div>
                                <div class="slider-navigation">
                                    <div class="swiper-button-prev slider-btn prev"><i
                                            class="rt rt-arrow-left-long"></i></div>
                                    <div class="swiper-button-next slider-btn next"><i
                                            class="rt rt-arrow-right-long"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!--================= Banner Section End Here =================-->
    </header>

    <!-- ..::Offer Section Start Here::.. -->
    <div class="rts-offer-section">
        <div class="container">
            <div class="rts-offer-inner">
                <p class="description">Súper descuento del 10% en tu primera compra. Usando este código: <a href="#">NUEVO10</a>
                </p>
            </div>
        </div>
    </div>
    <!-- ..::Offer Section End Here::.. -->

    <!-- ..::New Collection Section Start Here::.. -->
    <div class="rts-new-collection-section section-gap">
        <div class="container">
            <div class="recent-products-header section-header">
            </div>
            <div class="swiper rts-cmmnSlider-over" data-swiper="pagination">
                <div class="swiper-wrapper">
                    {% for categoria in categorias %}
                        <div class="swiper-slide">
                            <div class="collection-item">

                                <a href="{% url 'productos:productos_por_categoria' categoria.id_categoria %}">
                                    {% if categoria.imagen %}
                                        <img src="{{ categoria.imagen.url }}" alt="{{ categoria.nombre }}">
                                    {% else %}
                                        <img src="/static/images/catagory/defaultCategorias.png"
                                             alt="{{ categoria.nombre }}">
                                    {% endif %}
                                </a>
                                <p class="item-quantity">
                                    {{ categoria.productos.count }} <span>items</span>
                                </p>

                                <a href="{% url 'productos:productos_por_categoria' categoria.id_categoria %}"
                                   class="item-catagory-box">
                                    <h3 class="title">{{ categoria.nombre|upper }}</h3>
                                </a>

                            </div>
                        </div>
                    {% endfor %}
                </div>


            </div>
        </div>
    </div>

    <div class="rts-hand-picked-products-section">
        <div class="container">
            <div class="section-header section-header3 text-center">
                <div class="wrapper">
                    <div class="sub-content">
                        <img class="line-1" src="/static/images/banner/wvbo-icon.png" alt="">
                        <span class="sub-text">Featured</span>
                        <img class="line-2" src="/static/images/banner/wvbo-icon.png" alt="">
                    </div>
                    <h2 class="title">HAND-PICKED PRODUCT</h2>
                </div>
            </div>
            <div class="slider-div">
                <div class="swiper rts-sixSlide-over">
                    <div class="swiper-wrapper">
                        <div class="swiper-slide">
                            <div class="product-item element-item1">
                                <a href="#" class="product-image image-hover-variations">
                                    <div class="image-vari1 image-vari"><img
                                            src="/static/images/hand-picked/slider-img8.webp" alt="product-image">
                                    </div>
                                    <div class="image-vari2 image-vari"><img
                                            src="/static/images/hand-picked/slider-img8_1.webp" alt="product-image">
                                    </div>
                                </a>
                                <div class="bottom-content">
                                    <a href="#" class="product-name">Underarm Smoothing Bra</a>
                                    <div class="action-wrap">
                                        <span class="price">$31.00</span>
                                    </div>
                                </div>
                                <div class="quick-action-button">
                                    <div class="cta-single cta-plus">
                                        <a href="#"><i class="rt-plus"></i></a>
                                    </div>
                                    <div class="cta-single cta-quickview">
                                        <button class="product-details-popup-btn"><i class="far fa-eye"></i></button>
                                    </div>
                                    <div class="cta-single cta-wishlist">
                                        <a href="#"><i class="far fa-heart"></i></a>
                                    </div>
                                    <div class="cta-single cta-addtocart">
                                        <a href="#"><i class="rt-basket-shopping"></i></a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="swiper-slide">
                            <div class="product-item element-item1">
                                <a href="#" class="product-image image-hover-variations">
                                    <div class="image-vari1 image-vari"><img
                                            src="/static/images/hand-picked/slider-img11.webp" alt="product-image">
                                    </div>
                                    <div class="image-vari2 image-vari"><img
                                            src="/static/images/hand-picked/slider-img11_1.webp" alt="product-image">
                                    </div>
                                </a>
                                <div class="bottom-content">
                                    <a href="#" class="product-name">Bali Underwire Bra</a>
                                    <div class="action-wrap">
                                        <span class="price">$31.00</span>
                                    </div>
                                </div>
                                <div class="quick-action-button">
                                    <div class="cta-single cta-plus">
                                        <a href="#"><i class="rt-plus"></i></a>
                                    </div>
                                    <div class="cta-single cta-quickview">
                                        <button class="product-details-popup-btn"><i class="far fa-eye"></i></button>
                                    </div>
                                    <div class="cta-single cta-wishlist">
                                        <a href="#"><i class="far fa-heart"></i></a>
                                    </div>
                                    <div class="cta-single cta-addtocart">
                                        <a href="#"><i class="rt-basket-shopping"></i></a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="swiper-slide">
                            <div class="product-item element-item1">
                                <a hhref="#" class="product-image image-hover-variations">
                                    <div class="image-vari1 image-vari"><img
                                            src="/static/images/hand-picked/slider-img1.jpg" alt="product-image">
                                    </div>
                                    <div class="image-vari2 image-vari"><img
                                            src="/static/images/hand-picked/slider-img1-1.jpg" alt="product-image">
                                    </div>
                                </a>
                                <div class="bottom-content">
                                    <a href="#" class="product-name">Bali Underwire Bra</a>
                                    <div class="action-wrap">
                                        <span class="price">$31.00</span>
                                    </div>
                                </div>
                                <div class="quick-action-button">
                                    <div class="cta-single cta-plus">
                                        <a href="#"><i class="rt-plus"></i></a>
                                    </div>
                                    <div class="cta-single cta-quickview">
                                        <button class="product-details-popup-btn"><i class="far fa-eye"></i></button>
                                    </div>
                                    <div class="cta-single cta-wishlist">
                                        <a href="#"><i class="far fa-heart"></i></a>
                                    </div>
                                    <div class="cta-single cta-addtocart">
                                        <a href="#"><i class="rt-basket-shopping"></i></a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="swiper-slide">
                            <div class="product-item element-item1">
                                <a href="#" class="product-image image-hover-variations">
                                    <div class="image-vari1 image-vari"><img
                                            src="/static/images/hand-picked/slider-img13.webp" alt="product-image">
                                    </div>
                                    <div class="image-vari2 image-vari"><img
                                            src="/static/images/hand-picked/slider-img13-1.webp" alt="product-image">
                                    </div>
                                </a>
                                <div class="bottom-content">
                                    <a href="#" class="product-name">Bali Underwire Bra</a>
                                    <div class="action-wrap">
                                        <span class="price">$31.00</span>
                                    </div>
                                </div>
                                <div class="quick-action-button">
                                    <div class="cta-single cta-plus">
                                        <a href="#"><i class="rt-plus"></i></a>
                                    </div>
                                    <div class="cta-single cta-quickview">
                                        <button class="product-details-popup-btn"><i class="far fa-eye"></i></button>
                                    </div>
                                    <div class="cta-single cta-wishlist">
                                        <a href="#"><i class="far fa-heart"></i></a>
                                    </div>
                                    <div class="cta-single cta-addtocart">
                                        <a href="#"><i class="rt-basket-shopping"></i></a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="swiper-slide">
                            <div class="product-item element-item1">
                                <a href="#" class="product-image image-hover-variations">
                                    <div class="image-vari1 image-vari"><img
                                            src="/static/images/hand-picked/slider-img7.webp" alt="product-image">
                                    </div>
                                    <div class="image-vari2 image-vari"><img
                                            src="/static/images/hand-picked/slider-img7_1.webp" alt="product-image">
                                    </div>
                                </a>
                                <div class="bottom-content">
                                    <a href="#" class="product-name">Maidenform Bra</a>
                                    <div class="action-wrap">
                                        <span class="price">$31.00</span>
                                    </div>
                                </div>
                                <div class="quick-action-button">
                                    <div class="cta-single cta-plus">
                                        <a href="#"><i class="rt-plus"></i></a>
                                    </div>
                                    <div class="cta-single cta-quickview">
                                        <button class="product-details-popup-btn"><i class="far fa-eye"></i></button>
                                    </div>
                                    <div class="cta-single cta-wishlist">
                                        <a href="#"><i class="far fa-heart"></i></a>
                                    </div>
                                    <div class="cta-single cta-addtocart">
                                        <a href="#"><i class="rt-basket-shopping"></i></a>
                                    </div>
                                </div>
                                <div class="product-features">
                                    <div class="discount-tag product-tag">-38%</div>
                                    <div class="new-tag product-tag">HOT</div>
                                </div>
                            </div>
                        </div>
                        <div class="swiper-slide">
                            <div class="product-item element-item1">
                                <a href="#" class="product-image image-hover-variations">
                                    <div class="image-vari1 image-vari"><img
                                            src="/static/images/hand-picked/slider-img9.webp" alt="product-image">
                                    </div>
                                    <div class="image-vari2 image-vari"><img
                                            src="/static/images/hand-picked/slider-img9_1.webp" alt="product-image">
                                    </div>
                                </a>
                                <div class="bottom-content">
                                    <a href="#" class="product-name">Champion Bra</a>
                                    <div class="action-wrap">
                                        <span class="price">$31.00</span>
                                    </div>
                                </div>
                                <div class="quick-action-button">
                                    <div class="cta-single cta-plus">
                                        <a href="#"><i class="rt-plus"></i></a>
                                    </div>
                                    <div class="cta-single cta-quickview">
                                        <button class="product-details-popup-btn"><i class="far fa-eye"></i></button>
                                    </div>
                                    <div class="cta-single cta-wishlist">
                                        <a href="#"><i class="far fa-heart"></i></a>
                                    </div>
                                    <div class="cta-single cta-addtocart">
                                        <a href="#"><i class="rt-basket-shopping"></i></a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- ..::Hand Picked Section End Here::.. -->

    <!-- ..::Deal Section Start Here::.. -->
    <div class="rts-deal-section1">
        <div class="container">
            <div class="section-inner">
                <div class="row">
                    <div class="col-xl-6 col-lg-6 col-md-6 col-sm-12 col-12"></div>
                    <div class="col-xl-6 col-lg-6 col-md-6 col-sm-12 col-12">
                        <div class="single-inner">
                            <div class="content-box">
                                <div class="sub-content">
                                    <img class="line-1" src="/static/images/banner/wvbo-icon.png" alt="">
                                    <span class="sub-text">Deal Of The Week</span>
                                </div>
                                <h2 class="slider-title">Roland Grand White <br> short T-shirt </h2>
                                <div class="slider-description">
                                    <p>Our intent and our actions have always been informed by progress. We
                                        look at an impact report as a way to measure.</p>
                                </div>
                                <div class="countdown" id="countdown">
                                    <ul>
                                        <li><span id="days"></span>D</li>
                                        <li><span id="hours"></span>H</li>
                                        <li><span id="minutes"></span>M</li>
                                        <li><span id="seconds"></span>S</li>
                                    </ul>
                                </div>
                                <div class="content-bottom">
                                    <div class="img-box"><img src="/static/images/hand-picked/deal-icon.png" alt="">
                                    </div>
                                    <p class="content">Limited time offer. The deal will expires <br>
                                        on November 12, 2024 HURRY UP!</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- ..::Deal Section End Here::.. -->

    <!-- ..::Featured Product Section Start Here::.. -->
    <div class="rts-featured-product-section1">
        <div class="container">
            <div class="rts-featured-product-section-inner">
                <div class="section-header section-header3 text-center">
                    <div class="wrapper">
                        <div class="sub-content">
                            <img class="line-1" src="/static/images/banner/wvbo-icon.png" alt="">
                            <span class="sub-text">Featured</span>
                            <img class="line-2" src="/static/images/banner/wvbo-icon.png" alt="">
                        </div>
                        <h2 class="title">FEATURED PRODUCT</h2>
                    </div>
                </div>
                <div class="row">
                    <div class="col-xl-3 col-md-4 col-sm-6 col-12">
                        <div class="product-item element-item1">
                            <a href="#" class="product-image image-hover-variations">
                                <div class="image-vari1 image-vari"><img
                                        src="/static/images/hand-picked/slider-img13-1.webp" alt="product-image">
                                </div>
                                <div class="image-vari2 image-vari"><img
                                        src="/static/images/hand-picked/slider-img13.webp" alt="product-image">
                                </div>
                            </a>
                            <div class="bottom-content">
                                <div class="star-rating">
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                </div>
                                <a href="#" class="product-name">Girl's Sport Bra</a>
                                <div class="action-wrap">
                                    <span class="price">$31.00</span>
                                </div>
                            </div>
                            <div class="quick-action-button">
                                <div class="cta-single cta-plus">
                                    <a href="#"><i class="rt-plus"></i></a>
                                </div>
                                <div class="cta-single cta-quickview">
                                    <button class="product-details-popup-btn"><i class="far fa-eye"></i></button>
                                </div>
                                <div class="cta-single cta-wishlist">
                                    <a href="#"><i class="far fa-heart"></i></a>
                                </div>
                                <div class="cta-single cta-addtocart">
                                    <a href="#"><i class="rt-basket-shopping"></i></a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-3 col-md-4 col-sm-6 col-12">
                        <div class="product-item element-item1">
                            <a href="#" class="product-image image-hover-variations">
                                <div class="image-vari1 image-vari"><img
                                        src="/static/images/hand-picked/slider-img14.webp" alt="product-image">
                                </div>
                                <div class="image-vari2 image-vari"><img
                                        src="/static/images/hand-picked/slider-img14-1.webp" alt="product-image">
                                </div>
                            </a>
                            <div class="bottom-content">
                                <div class="star-rating">
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                </div>
                                <a href="#" class="product-name">Girl's Sport Bra</a>
                                <div class="action-wrap">
                                    <span class="price">$31.00</span>
                                </div>
                            </div>
                            <div class="quick-action-button">
                                <div class="cta-single cta-plus">
                                    <a href="#"><i class="rt-plus"></i></a>
                                </div>
                                <div class="cta-single cta-quickview">
                                    <button class="product-details-popup-btn"><i class="far fa-eye"></i></button>
                                </div>
                                <div class="cta-single cta-wishlist">
                                    <a href="#"><i class="far fa-heart"></i></a>
                                </div>
                                <div class="cta-single cta-addtocart">
                                    <a href="#"><i class="rt-basket-shopping"></i></a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-3 col-md-4 col-sm-6 col-12">
                        <div class="product-item element-item2">
                            <a href="#" class="product-image image-slider-variations">
                                <div class="swiper productSlide">
                                    <div class="swiper-wrapper">
                                        <div class="swiper-slide">
                                            <div class="image-vari1 image-vari"><img
                                                    src="/static/images/hand-picked/slider-img12-1.webp"
                                                    alt="product-image">
                                            </div>
                                        </div>
                                        <div class="swiper-slide">
                                            <div class="image-vari2 image-vari"><img
                                                    src="/static/images/hand-picked/slider-img11_1.webp"
                                                    alt="product-image">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="slider-buttons">
                                    <div class="button-prev slider-btn"><i class="rt-arrow-left-long"></i></div>
                                    <div class="button-next slider-btn"><i class="rt-arrow-right-long"></i></div>
                                </div>
                            </a>
                            <div class="bottom-content">
                                <div class="star-rating">
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star-half-alt"></i>
                                </div>
                                <a href="#" class="product-name">Maidenform Bra</a>
                                <div class="action-wrap">
                                    <span class="price">$31.00</span>
                                </div>
                            </div>
                            <div class="quick-action-button">
                                <div class="cta-single cta-plus">
                                    <a href="#"><i class="rt-plus"></i></a>
                                </div>
                                <div class="cta-single cta-quickview">
                                    <button class="product-details-popup-btn"><i class="far fa-eye"></i></button>
                                </div>
                                <div class="cta-single cta-wishlist">
                                    <a href="#"><i class="far fa-heart"></i></a>
                                </div>
                                <div class="cta-single cta-addtocart">
                                    <a href="#"><i class="rt-basket-shopping"></i></a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-3 col-md-4 col-sm-6 col-12">
                        <div class="product-item element-item1">
                            <a href="#" class="product-image image-hover-variations">
                                <div class="image-vari1 image-vari"><img
                                        src="/static/images/hand-picked/slider-img12.webp" alt="product-image">
                                </div>
                                <div class="image-vari2 image-vari"><img
                                        src="/static/images/hand-picked/slider-img12-3.webp" alt="product-image">
                                </div>
                            </a>
                            <div class="bottom-content">
                                <div class="star-rating">
                                    <i class="far fa-star"></i>
                                    <i class="far fa-star"></i>
                                    <i class="far fa-star"></i>
                                    <i class="far fa-star"></i>
                                    <i class="far fa-star"></i>
                                </div>
                                <a href="#" class="product-name">Hanes Women's Bra</a>
                                <div class="action-wrap">
                                    <span class="price">$31.00</span>
                                </div>
                            </div>
                            <div class="quick-action-button">
                                <div class="cta-single cta-plus">
                                    <a href="#"><i class="rt-plus"></i></a>
                                </div>
                                <div class="cta-single cta-quickview">
                                    <button class="product-details-popup-btn"><i class="far fa-eye"></i></button>
                                </div>
                                <div class="cta-single cta-wishlist">
                                    <a href="#"><i class="far fa-heart"></i></a>
                                </div>
                                <div class="cta-single cta-addtocart">
                                    <a href="#"><i class="rt-basket-shopping"></i></a>
                                </div>
                            </div>
                            <div class="product-features">
                                <div class="discount-tag product-tag">-38%</div>
                                <div class="new-tag product-tag">HOT</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- ..::Featured Product Section End Here::.. -->

    <!-- ..::Posters Section Start Here::.. -->
    <div class="rts-posters-section1">
        <div class="container">
            <div class="row">
                <div class="col-xl-3 col-lg-6 col-sm-6 col-12">
                    <a href="#" class="product-box product-box-medium product-box-medium5">
                        <div class="contents">
                            <span class="pretitle">50% Offer</span>
                            <h1 class="product-title">Last call for up <br> to 30% off</h1>
                            <div class="view-collections go-btn">VIEW COLLECTIONS <i class="rt-arrow-right-long"></i>
                            </div>
                        </div>
                        <div class="product-thumb"><img src="/static/images/featured/pot.png" alt="product-thumb">
                        </div>
                    </a>
                </div>
                <div class="col-xl-6 col-lg-12 col-sm-12 col-12 last-child">
                    <a href="#" class="product-box product-box-medium mid">
                        <div class="contents">
                            <span class="pretitle">-45% Offer</span>
                            <h1 class="product-title">SUMMER COLLECTION</h1>
                            <p>Don't miss the last opportunity</p>
                        </div>
                        <div class="product-thumb product-thumb1"><img src="/static/images/products/dress.png"
                                                                       alt="product-thumb"></div>
                    </a>
                </div>
                <div class="col-xl-3 col-lg-6 col-sm-6 col-12">
                    <a href="#" class="product-box product-box-medium product-box-medium3">
                        <div class="contents">
                            <span class="pretitle">SUMMER DRESS</span>
                            <h1 class="product-title">BEST COLLECTION</h1>
                            <div class="view-collections go-btn">Shop Now <i class="rt-arrow-right-long"></i></div>
                        </div>
                        <div class="product-thumb"><img src="/static/images/featured/3rd-image.png" alt="product-thumb">
                        </div>
                    </a>
                </div>
            </div>
        </div>
    </div>
    <!-- ..::Posters Section End Here::.. -->

    <!-- ..::Brand Section Start Here::.. -->
    <div class="rts-brands-section1 brand-bg3">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-lg-12">
                    <div class="slider-div">
                        <div class="swiper rts-brandSlide1">
                            <div class="swiper-wrapper">
                                <div class="swiper-slide">
                                    <a class="brand-front" href="#"><img src="/static/images/brands/client-01.png"
                                                                         alt="Brand Logo"></a>
                                </div>
                                <div class="swiper-slide">
                                    <a class="brand-front" href="#"><img src="/static/images/brands/client-02.png"
                                                                         alt="Brand Logo"></a>
                                </div>
                                <div class="swiper-slide">
                                    <a class="brand-front" href="#"><img src="/static/images/brands/client-03.png"
                                                                         alt="Brand Logo"></a>
                                </div>
                                <div class="swiper-slide">
                                    <a class="brand-front" href="#"><img src="/static/images/brands/client-04.png"
                                                                         alt="Brand Logo"></a>
                                </div>
                                <div class="swiper-slide">
                                    <a class="brand-front" href="#"><img src="/static/images/brands/client-05.png"
                                                                         alt="Brand Logo"></a>
                                </div>
                                <div class="swiper-slide">
                                    <a class="brand-front" href="#"><img src="/static/images/brands/client-06.png"
                                                                         alt="Brand Logo"></a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- ..::Brand Section End Here::.. -->

    <!-- ..::Featured Product Section Start Here::.. -->
    <div class="rts-featured-product-section3">
        <div class="container">
            <div class="rts-featured-product-section-inner">
                <div class="section-header section-header3 text-center">
                    <div class="wrapper">
                        <div class="sub-content">
                            <img class="line-1" src="/static/images/banner/wvbo-icon.png" alt="">
                            <span class="sub-text">Featured</span>
                            <img class="line-2" src="/static/images/banner/wvbo-icon.png" alt="">
                        </div>
                        <h2 class="title">FEATURED PRODUCT</h2>
                    </div>
                </div>
                <div class="row">
                    <div class="col-xl-4 col-md-6 col-sm-12">
                        <div class="full-wrapper wrapper-1">
                            <div class="image-part">
                                <a href="#" class="image"><img src="/static/images/featured/img-1.jpg"
                                                               alt="Featured Image"></a>
                            </div>
                            <div class="blog-content">
                            <span class="date-full">
                                <span class="day">25</span>
                                <br>
                                <span class="month">Jul</span>
                            </span>
                                <ul class="blog-meta">
                                    <li><a href="#">WINTER DRESS</a></li>
                                </ul>
                                <div class="title">
                                    <a href="#">Once that’s determined with a good, you need to come up with a name</a>
                                </div>
                                <div class="author-info d-flex align-items-center">
                                    <div class="avatar"><img src="/static/images/featured/author.png"
                                                             alt="Author Image"></div>
                                    <div class="info">
                                        <p class="author-name">PixcelsThemes</p>
                                        <p class="author-dsg">Author</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-4 col-md-6 col-sm-12">
                        <div class="full-wrapper wrapper-2">
                            <div class="image-part">
                                <a href="#" class="image"><img src="/static/images/featured/img-2.jpg"
                                                               alt="Featured Image"></a>
                            </div>
                            <div class="blog-content">
                            <span class="date-full">
                                <span class="day">25</span>
                                <br>
                                <span class="month">Jul</span>
                            </span>
                                <ul class="blog-meta">
                                    <li><a href="#">WINTER DRESS</a></li>
                                </ul>
                                <div class="title">
                                    <a href="#">Once determined, you need to come up with a name a legal structure</a>
                                </div>
                                <div class="author-info d-flex align-items-center">
                                    <div class="avatar"><img src="/static/images/featured/author.png"
                                                             alt="Author Image"></div>
                                    <div class="info">
                                        <p class="author-name">PixcelsThemes</p>
                                        <p class="author-dsg">Author</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-4 col-md-6 col-sm-12">
                        <div class="full-wrapper wrapper-3">
                            <div class="image-part">
                                <a href="#" class="image"><img src="/static/images/featured/img-3.jpg"
                                                               alt="Featured Image"></a>
                            </div>
                            <div class="blog-content">
                            <span class="date-full">
                                <span class="day">25</span>
                                <br>
                                <span class="month">Jul</span>
                            </span>
                                <ul class="blog-meta">
                                    <li><a href="#">WINTER DRESS</a></li>
                                </ul>
                                <div class="title">
                                    <a href="#">At the limit, statically generated, edge delivered a food</a>
                                </div>
                                <div class="author-info d-flex align-items-center">
                                    <div class="avatar"><img src="/static/images/featured/author.png"
                                                             alt="Author Image"></div>
                                    <div class="info">
                                        <p class="author-name">PixcelsThemes</p>
                                        <p class="author-dsg">Author</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- ..::Featured Product Section End Here::.. -->



    <!-- ..::Product-details Section Start Here::.. -->
    <div class="product-details-popup-wrapper">
        <div class="rts-product-details-section rts-product-details-section2 product-details-popup-section">
            <div class="product-details-popup">
                <button class="product-details-close-btn"><i class="fal fa-times"></i></button>
                <div class="details-product-area">
                    <div class="product-thumb-area">
                        <div class="cursor"></div>
                        <div class="thumb-wrapper one filterd-items figure">
                            <div class="product-thumb zoom" onmousemove="zoom(event)"
                                 style="background-image: url('/static/images/products/product-details.jpg')"><img
                                    src="/static/images/products/product-details.jpg" alt="product-thumb">
                            </div>
                        </div>
                        <div class="thumb-wrapper two filterd-items hide">
                            <div class="product-thumb zoom" onmousemove="zoom(event)"
                                 style="background-image: url('/static/images/products/product-filt2.jpg')"><img
                                    src="/static/images/products/product-filt2.jpg" alt="product-thumb">
                            </div>
                        </div>
                        <div class="thumb-wrapper three filterd-items hide">
                            <div class="product-thumb zoom" onmousemove="zoom(event)"
                                 style="background-image: url('/static/images/products/product-filt3.jpg')"><img
                                    src="/static/images/products/product-filt3.jpg" alt="product-thumb">
                            </div>
                        </div>
                        <div class="product-thumb-filter-group">
                            <div class="thumb-filter filter-btn active" data-show=".one"><img
                                    src="/static/images/products/product-filt1.jpg" alt="product-thumb-filter"></div>
                            <div class="thumb-filter filter-btn" data-show=".two"><img
                                    src="/static/images/products/product-filt2.jpg" alt="product-thumb-filter"></div>
                            <div class="thumb-filter filter-btn" data-show=".three"><img
                                    src="/static/images/products/product-filt3.jpg" alt="product-thumb-filter"></div>
                        </div>
                    </div>
                    <div class="contents">
                        <div class="product-status">
                            <span class="product-catagory">Dress</span>
                            <div class="rating-stars-group">
                                <div class="rating-star"><i class="fas fa-star"></i></div>
                                <div class="rating-star"><i class="fas fa-star"></i></div>
                                <div class="rating-star"><i class="fas fa-star-half-alt"></i></div>
                                <span>10 Reviews</span>
                            </div>
                        </div>
                        <h2 class="product-title">Wide Cotton Tunic Dress <span class="stock">In Stock</span></h2>
                        <span class="product-price"><span class="old-price">$9.35</span> $7.25</span>
                        <p>
                            Priyoshop has brought to you the Hijab 3 Pieces Combo Pack PS23. It is a
                            completely modern design and you feel comfortable to put on this hijab.
                            Buy it at the best price.
                        </p>
                        <div class="product-bottom-action">
                            <div class="cart-edit">
                                <div class="quantity-edit action-item">
                                    <button class="button"><i class="fal fa-minus minus"></i></button>
                                    <input type="text" class="input" value="01"/>
                                    <button class="button plus">+<i class="fal fa-plus plus"></i></button>
                                </div>
                            </div>
                            <a href="#" class="addto-cart-btn action-item"><i class="rt-basket-shopping"></i>
                                Add To
                                Cart</a>
                            <a href="#" class="wishlist-btn action-item"><i class="rt-heart"></i></a>
                        </div>
                        <div class="product-uniques">
                            <span class="sku product-unipue"><span>SKU: </span> BO1D0MX8SJ</span>
                            <span class="catagorys product-unipue"><span>Categories: </span> T-Shirts, Tops, Mens</span>
                            <span class="tags product-unipue"><span>Tags: </span> fashion, t-shirts, Men</span>
                        </div>
                        <div class="share-social">
                            <span>Share:</span>
                            <a class="platform" href="http://facebook.com" target="_blank"><i
                                    class="fab fa-facebook-f"></i></a>
                            <a class="platform" href="http://twitter.com" target="_blank"><i class="fab fa-twitter"></i></a>
                            <a class="platform" href="http://behance.com" target="_blank"><i class="fab fa-behance"></i></a>
                            <a class="platform" href="http://youtube.com" target="_blank"><i class="fab fa-youtube"></i></a>
                            <a class="platform" href="http://linkedin.com" target="_blank"><i
                                    class="fab fa-linkedin"></i></a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- ..::Product-details Section End Here::.. -->
    <script>
        (function () {
            const csrftoken = document.querySelector('meta[name="csrf-token"]').getAttribute('content');

            function fetchJSON(url, options) {
                return fetch(url, options).then(r => {
                    if (!r.ok) throw new Error('HTTP ' + r.status);
                    return r.json();
                });
            }

            // --- Renderiza items en header a partir del JSON que devuelve cart-data ---
            function renderHeader(items, total) {
                const container = document.getElementById('header-product-area');
                const countEl = document.getElementById('cart-count');
                const totalEl = document.getElementById('header-total');
                const badgeEl = document.getElementById('header-cart-badge'); // 👈 NUEVO
                const badgeElMovil = document.getElementById('header-cart-badge-movil');
                if (!container) return;


                if (!items || items.length === 0) {
                    container.innerHTML = '<div class="empty-cart">Tu carrito está vacío</div>';
                    countEl.innerText = '0';
                    totalEl.innerText = '$0.00';
                    if (badgeEl) badgeEl.innerText = '0'; // 👈
                    if (badgeElMovil) badgeElMovil.innerText = '0'; // 👈
                    return;
                }

                countEl.innerText = items.reduce((s, i) => s + i.cantidad, 0);
                const totalItems = items.reduce((s, i) => s + i.cantidad, 0);// 👈
                totalEl.innerText = '$ ' + parseFloat(total).toFixed(2);
                if (badgeEl) badgeEl.innerText = totalItems; // 👈
                if (badgeEl) badgeElMovil.innerText = totalItems; // 👈

                // construir HTML de cada item
                container.innerHTML = items.map(item => {
                    return `
            <div class="product-item" data-item="${item.id}">
                <div class="product-detail">
                    <div class="product-thumb"><img src="${item.imagen}" alt="product-thumb" ></div>
                    <div class="item-wrapper">
                        <span class="product-name">${escapeHtml(item.nombre)}</span>

                            <div class="item-wrapper"> 
                                ${item.variante ? `
                                <small class="product-variant text-muted">${escapeHtml(item.variante)}</small>` : ''}
                            </div>


                        <div class="item-wrapper">
                            <div class="item-wrapper">
                                <span class="product-qnty">${item.cantidad} ×</span>
                                <span class="product-price">$ ${parseFloat(item.precio_unitario).toFixed(2)}</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="cart-edit">
                    <div class="quantity-edit">
                        <button class="button header-minus" data-item="${item.id}"><i class="fal fa-minus"></i></button>
                        <input type="text" class="input header-qty" value="${item.cantidad}" readonly />
                        <button class="button header-plus" data-item="${item.id}"><i class="fal fa-plus"></i></button>
                    </div>
                    <div class="item-wrapper d-flex mr--5 align-items-center">
                        <a href="#" class="delete-cart" data-item="${item.id}"><i class="fal fa-times"></i></a>
                    </div>
                </div>
            </div>
            `;
                }).join('');
            }

            // sanitize simple text
            function escapeHtml(text) {
                return String(text)
                    .replace(/&/g, '&amp;')
                    .replace(/</g, '&lt;')
                    .replace(/>/g, '&gt;')
                    .replace(/"/g, '&quot;')
                    .replace(/'/g, '&#039;');
            }

            // --- obtiene el estado actual del carrito (llama a tu view cart_data) ---
            function refreshHeaderCart() {
                fetchJSON("{% url 'productos:cart_data' %}")
                    .then(data => {
                        renderHeader(data.items, data.total);
                    })
                    .catch(err => {
                        console.error('Error cargando cart_data', err);
                    });
            }

            // --- acciones: actualizar cantidad / eliminar: usan los endpoints ya existentes ---
            function postActualizar(itemId, cantidad) {
                const fd = new FormData();
                fd.append('item_id', itemId);
                fd.append('cantidad', cantidad);

                return fetch("{% url 'productos:actualizar_item_carrito' %}", {
                    method: 'POST',
                    headers: {'X-CSRFToken': csrftoken},
                    body: fd
                }).then(r => r.json());
            }

            function postEliminar(itemId) {
                const fd = new FormData();
                fd.append('item_id', itemId);

                return fetch("{% url 'productos:eliminar_item_carrito' %}", {
                    method: 'POST',
                    headers: {'X-CSRFToken': csrftoken},
                    body: fd
                }).then(r => r.json());
            }

            // --- actualiza la fila del template cart si existe en la página (sin recargar) ---
            function updateCartPageRow(itemData) {
                // itemData: {id, cantidad, subtotal, total} asumido según respuesta del backend
                const row = document.querySelector(`tr[data-item="${itemData.id}"]`);
                if (!row) return;

                const input = row.querySelector('input');
                if (input) input.value = itemData.cantidad;

                const subtotalEl = document.getElementById(`subtotal-${itemData.id}`);
                if (subtotalEl) subtotalEl.innerText = '$ ' + parseFloat(itemData.subtotal).toFixed(2);

                const totalEl = document.getElementById('total');
                if (totalEl) totalEl.innerText = '$ ' + parseFloat(itemData.total).toFixed(2);
            }

            // --- delegado de eventos en header para plus/minus/delete ---
            document.addEventListener('click', function (e) {
                const plusBtn = e.target.closest('.header-plus');
                if (plusBtn) {
                    e.preventDefault();
                    const itemId = plusBtn.dataset.item;
                    // obtener cantidad actual (del input) +1 o pedir al servidor actualice
                    const input = document.querySelector(`.product-item[data-item="${itemId}"] .header-qty`);
                    let cantidad = parseInt(input ? input.value : '1') + 1;
                    plusBtn.disabled = true;
                    postActualizar(itemId, cantidad)
                        .then(data => {
                            // data.cantidad, data.subtotal, data.total esperados
                            refreshHeaderCart(); // re-popula header desde server (estado fuente)
                            if (data && !data.error) updateCartPageRow({
                                id: itemId,
                                cantidad: data.cantidad,
                                subtotal: data.subtotal,
                                total: data.total
                            });
                        })
                        .finally(() => plusBtn.disabled = false);
                    return;
                }

                const minusBtn = e.target.closest('.header-minus');
                if (minusBtn) {
                    e.preventDefault();
                    const itemId = minusBtn.dataset.item;
                    const input = document.querySelector(`.product-item[data-item="${itemId}"] .header-qty`);
                    let cantidad = Math.max(1, (parseInt(input ? input.value : '1') - 1));
                    minusBtn.disabled = true;
                    postActualizar(itemId, cantidad)
                        .then(data => {
                            refreshHeaderCart();
                            if (data && !data.error) updateCartPageRow({
                                id: itemId,
                                cantidad: data.cantidad,
                                subtotal: data.subtotal,
                                total: data.total
                            });
                        })
                        .finally(() => minusBtn.disabled = false);
                    return;
                }

                const del = e.target.closest('.delete-cart');
                if (del) {
                    e.preventDefault();
                    const itemId = del.dataset.item;

                    del.disabled = true;
                    postEliminar(itemId)
                        .then(data => {
                            refreshHeaderCart();
                            if (data && !data.error) {
                                const row = document.querySelector(`tr[data-item="${itemId}"]`);
                                if (row) row.remove();

                                const totalEl = document.getElementById('total');
                                if (totalEl && data.total !== undefined) {
                                    totalEl.innerText = '$ ' + parseFloat(data.total).toFixed(2);
                                }
                            }
                        })
                        .finally(() => del.disabled = false);
                    return;
                }
            });

            // inicializar
            document.addEventListener('DOMContentLoaded', function () {
                refreshHeaderCart();
                // opcional: refrescar cada X minutos: setInterval(refreshHeaderCart, 1000 * 60 * 2);
            });

            // Exponer para que otras partes del sitio puedan refrescar el header
            window.refreshHeaderCart = refreshHeaderCart;
        })();
    </script>
{% endblock content %}